<form flex novalidate name="personAffiliationTechnicianForm[num]"
        ng-submit="personAffiliationTechnicianForm[num].$valid
        && vm.submitAffiliationTechnician(vm.forms['personAffiliationTech'], vm.selectedIndex-2,vm.thisPerson[vm.selectedIndex-2])">
    <md-card-content layout="column" flex>
        <div ng-if="!vm.nothingToShow(vm.currentAffiliationsTech[vm.selectedIndex-2],'tech_id')" layout="column">
            <div ng-repeat="(numOff,affLab) in vm.currentAffiliationsTech[vm.selectedIndex-2] track by $index"
                layout="column">
                <fieldset class="spacer">
                    <div layout="column" layout-gt-xs="row">
                        <md-input-container
                            class="search-box select-container input-row">
                            <label>Facility</label>
                            <md-select required ng-model="vm.currentAffiliationsTech[vm.selectedIndex-2][numOff].tech_office_id"
                                    md-container-class="correct-overflow" name="affTech_id[numOff]">
                                <md-option ng-repeat="office in vm.facilities"
                                    ng-value="office.id">{{office.name_en}}</md-option>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div layout="column" layout-gt-xs="row">
                        <md-input-container>
                            <label>Dedication (%)</label>
                            <input required ng-model="vm.currentAffiliationsTech[vm.selectedIndex-2][numOff].tech_dedication"
                                    name="affTech_dedication[numOff]" dedication-validate>
                        </md-input-container>
                        <md-input-container>
                            <label>Position</label>
                            <md-select ng-model="vm.currentAffiliationsTech[vm.selectedIndex-2][numOff].tech_position_id"
                                    name="affTech_position[numOff]">
                                <md-option ng-repeat="pos in vm.technicianPositions" ng-value="pos.id">{{pos.name_en}}</md-option>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div layout="column" layout-gt-xs="row">
                        <md-input-container class="input-row-longer">
                            <label>Start</label>
                            <md-datepicker md-current-view="year" required ng-model="vm.currentAffiliationsTech[vm.selectedIndex-2][numOff].tech_valid_from"
                                    name="affTech_start[numOff]" md-placeholder="Enter date"></md-datepicker>
                        </md-input-container>
                        <md-input-container class="input-row-longer">
                            <label>End</label>
                            <md-datepicker md-current-view="year" ng-model="vm.currentAffiliationsTech[vm.selectedIndex-2][numOff].tech_valid_until"
                                    name="affTech_end[numOff]" md-placeholder="Enter date"></md-datepicker>
                        </md-input-container>
                        <div layout="row" layout-align="start center">
                            <md-button ng-click="vm.removeRows2(vm.currentAffiliationsTech[vm.selectedIndex-2],numOff)"
                                    aria-label="Remove"
                                    class="md-icon-button interaction-button">
                                <md-icon md-svg-src="images/icons/remove_24px.svg"></md-icon>
                            </md-button>
                            <md-button ng-if="$last" ng-click="vm.addRows2(vm.currentAffiliationsTech[vm.selectedIndex-2], 'affiliationsTech')"
                                    aria-label="Add more" class="md-icon-button interaction-button">
                                <md-icon md-svg-src="images/icons/add_24px.svg"></md-icon>
                            </md-button>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
        <div ng-if="vm.nothingToShow(vm.currentAffiliationsTech[vm.selectedIndex-2],'tech_id')" layout="column">
             No data, press + to add
            <md-button ng-click="vm.addRows2(vm.currentAffiliationsTech[vm.selectedIndex-2], 'affiliationsTech')"
                    aria-label="Add more" class="md-icon-button interaction-button">
                <md-icon md-svg-src="images/icons/add_24px.svg"></md-icon>
            </md-button>
        </div>
        <div layout="column" layout-gt-sm="row" layout-align="none center">
            <md-button type="submit"
                class="button-small md-raised md-primary">Update</md-button>
            <div class="status-message" ng-hide="vm.hideMessage[vm.forms['personAffiliationTech']]">
                <span class="message" ng-class="vm.messageType[vm.forms['personAffiliationTech']]">
                    {{vm.updateStatus[vm.forms['personAffiliationTech']]}}
                </span>
            </div>
        </div>
    </md-card-content>
</form>